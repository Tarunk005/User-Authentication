<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Signup</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <div class="form-container">
    <h2>Sign Up</h2>

    {% if error %}
      <p style="color:red; text-align:center;">{{ error }}</p>
    {% endif %}

    <!-- Use action="{{ url_for('register') }}" to call Flask route -->
    <form method="POST" action="{{ url_for('register') }}" onsubmit="return validatePassword()">

      <input type="text" name="username" placeholder="Username" required><br>

      <input type="email" name="email" placeholder="Email" required><br>
      
      <!-- Password field with eye toggle -->
      <div class="password-wrapper">
        <input type="password" id="password" name="password" placeholder="Password" required 
               onfocus="showHint()" onkeyup="checkPassword()">
        <span class="eye-icon" onclick="togglePassword()">üëÅ</span>
      </div>

      <!-- Helper text / hints -->
      <small id="passwordHelp" class="password-hint" style="display:none;">
        Password must be at least 8 characters, 1 uppercase, 1 number, 1 special character.
      </small>

      <input type="password" id="confirm_password" name="confirm_password" placeholder="Confirm Password" required><br><br>

      <button type="submit">Register</button>
      <p style="text-align:center;">Already have an account? <a href="{{ url_for('login') }}">Login</a></p>
    </form>
  </div>

  <script>
    function showHint() {
      document.getElementById("passwordHelp").style.display = "block";
    }

    function checkPassword() {
      const password = document.getElementById("password").value;
      const helpText = document.getElementById("passwordHelp");

      const minLength = /.{8,}/;
      const upperCase = /[A-Z]/;
      const number = /[0-9]/;
      const specialChar = /[@$!%*?&]/;

      if (minLength.test(password) && upperCase.test(password) &&
          number.test(password) && specialChar.test(password)) {
        helpText.style.color = "lightgreen";
        helpText.textContent = "‚úÖ Strong password!";
      } else {
        helpText.style.color = "red";
        helpText.textContent = "‚ùå Must be 8+ chars, 1 uppercase, 1 number, 1 special char.";
      }
    }

    function validatePassword() {
      const password = document.getElementById("password").value;
      const confirmPassword = document.getElementById("confirm_password").value;

      const minLength = /.{8,}/;
      const upperCase = /[A-Z]/;
      const number = /[0-9]/;
      const specialChar = /[@$!%*?&]/;

      if (!(minLength.test(password) && upperCase.test(password) &&
            number.test(password) && specialChar.test(password))) {
        alert("Password does not meet requirements!");
        return false;
      }

      if (password !== confirmPassword) {
        alert("Passwords do not match!");
        return false;
      }

      return true; // ‚úÖ Let Flask handle submission
    }

    function togglePassword() {
      const passwordField = document.getElementById("password");
      const eyeIcon = document.querySelector(".eye-icon");

      if (passwordField.type === "password") {
        passwordField.type = "text";
        eyeIcon.textContent = "üö´"; // eye-slash icon
      } else {
        passwordField.type = "password";
        eyeIcon.textContent = "üëÅ";
      }
    }
  </script>
</body>
</html>